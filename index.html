<!DOCTYPE html>
<html>
<head>
  <title>ランダムリーダー選出</title>
</head>
<body>
  <h1>ランダムリーダー選出</h1>
  <button onclick="selectLeader()">リーダーを選出する</button>
  <p id="leader"></p>

  <script>
    async function selectLeader() {
      const response = await fetch('leaders.json');
      const data = await response.json();
      const leaders = data.leaders;
      const chosen = data.chosen;

      let availableLeaders = leaders.filter(leader => !chosen.includes(leader));
      
      if (availableLeaders.length === 0) {
        availableLeaders = leaders;
        data.chosen = [];
      }

      const randomIndex = Math.floor(Math.random() * availableLeaders.length);
      const selectedLeader = availableLeaders[randomIndex];
      data.chosen.push(selectedLeader);

      document.getElementById('leader').innerText = '本日のリーダー: ' + selectedLeader;

      await fetch('https://api.github.com/repos/PON-TAKERU-PON/random-picker/dispatches', {
        method: 'POST',
        headers: {
          'Authorization': 'token GH-TOKEN',
          'Accept': 'application/vnd.github.v3+json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          event_type: 'update-leaders',
          client_payload: data
        })
      });
    }
  </script>
</body>
</html>

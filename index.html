<!DOCTYPE html>
<html>
<head>
  <title>ランダムリーダー選出</title>
</head>
<body>
  <h1>ランダムリーダー選出</h1>
  <button onclick="selectLeader()">リーダーを選出する</button>
  <p id="leader"></p>

  <script>
    async function selectLeader() {
      const response = await fetch('leaders.json');
      const data = await response.json();
      const leaders = data.leaders;
      let chosen = data.chosen;

      // 選ばれていないリーダーを取得
      let availableLeaders = leaders.filter(leader => !chosen.includes(leader));

      // すべてのリーダーが選ばれた場合、リストをリセット
      if (availableLeaders.length === 0) {
        availableLeaders = leaders;
        chosen = [];
      }

      // ランダムにリーダーを選出
      const randomIndex = Math.floor(Math.random() * availableLeaders.length);
      const selectedLeader = availableLeaders[randomIndex];
      chosen.push(selectedLeader);

      // リーダーを表示
      document.getElementById('leader').innerText = '本日のリーダー: ' + selectedLeader;

      // leaders.jsonファイルを更新
      await fetch('https://api.github.com/repos/PON-TAKERU-PON/random-picker/dispatches', {
        method: 'POST',
        headers: {
          'Authorization': 'token GH_TOKEN',
          'Accept': 'application/vnd.github.v3+json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          event_type: 'update-leaders',
          client_payload: JSON.stringify({ leaders: leaders, chosen: chosen })
        })
      });
    }
  </script>
</body>
</html>

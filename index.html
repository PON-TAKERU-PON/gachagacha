<!DOCTYPE html>
<html>
<head>
  <title>ランダムリーダー選出</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 50px;
    }
    #wheel {
      margin: 20px auto;
      width: 300px;
      height: 300px;
      border: 10px solid #333;
      border-radius: 50%;
      position: relative;
    }
    #wheel .sector {
      position: absolute;
      width: 100%;
      height: 100%;
      clip-path: polygon(50% 50%, 100% 0, 100% 100%);
      transform-origin: 50% 50%;
      text-align: right;
      padding-right: 20px;
      box-sizing: border-box;
    }
    #wheel .sector:nth-child(1) { background: #f00; transform: rotate(0deg); }
    #wheel .sector:nth-child(2) { background: #ff8000; transform: rotate(40deg); }
    #wheel .sector:nth-child(3) { background: #ff0; transform: rotate(80deg); }
    #wheel .sector:nth-child(4) { background: #80ff00; transform: rotate(120deg); }
    #wheel .sector:nth-child(5) { background: #0f0; transform: rotate(160deg); }
    #wheel .sector:nth-child(6) { background: #00ff80; transform: rotate(200deg); }
    #wheel .sector:nth-child(7) { background: #0ff; transform: rotate(240deg); }
    #wheel .sector:nth-child(8) { background: #0080ff; transform: rotate(280deg); }
    #wheel .sector:nth-child(9) { background: #f0f; transform: rotate(320deg); }
    #pointer {
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 30px solid #333;
      margin: 20px auto;
      position: relative;
      top: -320px;
    }
    #spin {
      margin: 20px;
      padding: 10px 20px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1>ランダムリーダー選出</h1>
  <div id="pointer"></div>
  <div id="wheel">
    <div class="sector" style="transform: rotate(0deg);"><span>森さん</span></div>
    <div class="sector" style="transform: rotate(40deg);"><span>小寺さん</span></div>
    <div class="sector" style="transform: rotate(80deg);"><span>櫻井さん</span></div>
    <div class="sector" style="transform: rotate(120deg);"><span>斎藤さん</span></div>
    <div class="sector" style="transform: rotate(160deg);"><span>佐藤さん</span></div>
    <div class="sector" style="transform: rotate(200deg);"><span>川崎さん</span></div>
    <div class="sector" style="transform: rotate(240deg);"><span>丸田さん</span></div>
    <div class="sector" style="transform: rotate(280deg);"><span>染谷さん</span></div>
    <div class="sector" style="transform: rotate(320deg);"><span>石黒さん</span></div>
  </div>
  <button id="spin" onclick="spinWheel()">Spin the Wheel</button>
  <p id="leader"></p>

  <script>
    const leaders = ["森さん", "小寺さん", "櫻井さん", "斎藤さん", "佐藤さん", "川崎さん", "丸田さん", "染谷さん", "石黒さん"];
    let chosen = [];

    async function spinWheel() {
      const wheel = document.getElementById('wheel');
      const leaderElement = document.getElementById('leader');
      const spinButton = document.getElementById('spin');

      // Disable the button while spinning
      spinButton.disabled = true;

      // Get available leaders
      let availableLeaders = leaders.filter(leader => !chosen.includes(leader));

      // Reset if all have been chosen
      if (availableLeaders.length === 0) {
        availableLeaders = leaders;
        chosen = [];
      }

      // Select a random leader
      const randomIndex = Math.floor(Math.random() * availableLeaders.length);
      const selectedLeader = availableLeaders[randomIndex];

      // Spin the wheel
      const rotations = Math.floor(Math.random() * 5) + 5; // 5-10 full rotations
      const sectorAngle = 40; // 360 degrees / 9 sectors = 40 degrees per sector
      const angle = (randomIndex * sectorAngle) + (rotations * 360);

      wheel.style.transition = 'transform 4s cubic-bezier(0.33, 1, 0.68, 1)';
      wheel.style.transform = `rotate(${angle}deg)`;

      // Update chosen list after the spin ends
      setTimeout(() => {
        chosen.push(selectedLeader);
        leaderElement.innerText = `本日のリーダー: ${selectedLeader}`;
        
        // Update leaders.json on GitHub
        fetch('https://api.github.com/repos/PON-TAKERU-PON/random-leader-selector/dispatches', {
          method: 'POST',
          headers: {
            'Authorization': 'token GH_TOKEN',
            'Accept': 'application/vnd.github.v3+json',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            event_type: 'update-leaders',
            client_payload: { leaders: leaders, chosen: chosen }
          })
        });

        // Enable the button again
        spinButton.disabled = false;
      }, 4000); // 4 seconds
    }
  </script>
</body>
</html>
